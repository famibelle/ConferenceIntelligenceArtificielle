<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Conférence IA — Slides</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/reveal.js@4/dist/reveal.css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/reveal.js@4/dist/theme/black.css" id="theme" />
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <div class="reveal">
    <div class="slides">
      <!-- Charge le Markdown; utilisez --- pour séparer les slides, -- pour les sous-slides -->
      <section data-markdown="ConférenceIA.md"
               data-separator="^---$"
               data-separator-vertical="^--$"
               data-separator-notes="^Note:">
      </section>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/reveal.js@4/dist/reveal.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/reveal.js@4/plugin/markdown/markdown.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/reveal.js@4/plugin/highlight/highlight.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/reveal.js@4/plugin/notes/notes.js"></script>
  <script>
    Reveal.initialize({
      hash: true,
      slideNumber: true,
      center: false,
      plugins: [ RevealMarkdown, RevealHighlight, RevealNotes ],
    });

    function attr(sec, name, defVal) {
      const v = sec.getAttribute(name);
      return (v === null || v === undefined || v === '') ? defVal : v;
    }

    // Transforme les slides marquées avec data-layout="text-image"
    function applyTextImageLayout() {
      const sections = document.querySelectorAll('section[data-layout="text-image"]');
      sections.forEach(sec => {
        if (sec.dataset.layoutApplied === '1') return;
        const imgSrc = attr(sec, 'data-img', '');
        const alt = attr(sec, 'data-alt', '');
        const side = attr(sec, 'data-side', 'right');
        
        // Extract first heading as full-width title
        const heading = sec.querySelector('h1, h2');
        let headerHTML = '';
        if (heading) {
          headerHTML = heading.outerHTML;
          heading.remove();
        }
        const contentHTML = sec.innerHTML;

        const container = document.createElement('div');
        container.className = 'two-col';

        const colA = document.createElement('div');
        const colB = document.createElement('div');
        colA.className = 'col-left';
        colB.className = 'col-right';

        if (side === 'left') {
          // image left, text right
          if (imgSrc) {
            const img = document.createElement('img');
            img.src = imgSrc;
            img.alt = alt;
            colA.appendChild(img);
          }
          colB.innerHTML = contentHTML;
        } else {
          // text left, image right
          colA.innerHTML = contentHTML;
          if (imgSrc) {
            const img = document.createElement('img');
            img.src = imgSrc;
            img.alt = alt;
            colB.appendChild(img);
          }
        }

        container.appendChild(colA);
        container.appendChild(colB);
        sec.innerHTML = '';
        if (headerHTML) {
          const header = document.createElement('div');
          header.className = 'slide-header';
          header.innerHTML = headerHTML;
          sec.appendChild(header);
        }
        sec.appendChild(container);
        sec.dataset.layoutApplied = '1';
      });
    }

    Reveal.on('ready', applyTextImageLayout);
    Reveal.on('slidechanged', applyTextImageLayout);

    // Convertit une URL YouTube (youtu.be ou watch?v=) en URL d'embed
    function toYoutubeEmbed(url) {
      let embed = url;
      try {
        const u = new URL(url);
        // youtu.be/<id>
        if (u.hostname === 'youtu.be') {
          const id = u.pathname.replace('/', '');
          embed = `https://www.youtube.com/embed/${id}`;
        } else if (u.hostname.includes('youtube.com')) {
          // youtube.com/watch?v=<id>
          if (u.pathname === '/watch') {
            const id = u.searchParams.get('v');
            if (id) embed = `https://www.youtube.com/embed/${id}`;
          } else if (u.pathname.startsWith('/embed/')) {
            embed = url; // déjà embed
          }
        }
      } catch (e) { /* ignore, keep original */ }
      // Ajoute les paramètres d'autoplay et lecture inline (iOS) et mute pour compatibilité
      try {
        const eu = new URL(embed);
        eu.searchParams.set('autoplay', '1');
        eu.searchParams.set('mute', '1');
        eu.searchParams.set('playsinline', '1');
        return eu.toString();
      } catch (e) {
        return embed;
      }
    }

    // Mise en page texte / vidéo
    function applyTextVideoLayout() {
      const sections = document.querySelectorAll('section[data-layout="text-video"]');
      sections.forEach(sec => {
        if (sec.dataset.layoutApplied === '1') return;
        const videoUrl = attr(sec, 'data-video', '');
        const side = attr(sec, 'data-side', 'right');
        
        // Extract first heading as full-width title
        const heading = sec.querySelector('h1, h2');
        let headerHTML = '';
        if (heading) {
          headerHTML = heading.outerHTML;
          heading.remove();
        }
        const contentHTML = sec.innerHTML;

        const container = document.createElement('div');
        container.className = 'two-col';

        const colA = document.createElement('div');
        const colB = document.createElement('div');
        colA.className = 'col-left';
        colB.className = 'col-right';
        
        const videoEl = (() => {
          const wrapper = document.createElement('div');
          wrapper.className = 'video-container';
          const iframe = document.createElement('iframe');
          iframe.src = toYoutubeEmbed(videoUrl || '');
          iframe.allow = 'accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share';
          iframe.referrerPolicy = 'strict-origin-when-cross-origin';
          iframe.allowFullscreen = true;
          wrapper.appendChild(iframe);
          return wrapper;
        })();

        if (side === 'left') {
          // video left, text right
          colA.appendChild(videoEl);
          colB.innerHTML = contentHTML;
        } else {
          // text left, video right
          colA.innerHTML = contentHTML;
          colB.appendChild(videoEl);
        }

        container.appendChild(colA);
        container.appendChild(colB);
        sec.innerHTML = '';
        if (headerHTML) {
          const header = document.createElement('div');
          header.className = 'slide-header';
          header.innerHTML = headerHTML;
          sec.appendChild(header);
        }
        sec.appendChild(container);
        sec.dataset.layoutApplied = '1';
      });
    }

    Reveal.on('ready', applyTextVideoLayout);
    Reveal.on('slidechanged', applyTextVideoLayout);
  </script>
</body>
</html>
