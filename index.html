<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Conférence IA — Slides</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/reveal.js@4/dist/reveal.css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/reveal.js@4/dist/theme/black.css" id="theme" />
  <style>
    .reveal .slides { text-align: left; }
    /* Mise en page simple: texte à gauche, image à droite */
    .two-col { display: flex; gap: 2rem; align-items: center; }
    /* Allow columns to shrink and wrap their content */
    .two-col .col-left, .two-col .col-right { flex: 1; min-width: 0; }
    .two-col .col-right { text-align: center; }
    /* Better wrapping for long words/lines */
    .two-col .col-left, .two-col .col-right { overflow-wrap: anywhere; word-break: break-word; }
    /* Tame very large headings inside columns */
    .two-col :is(h1,h2,h3) { font-size: clamp(1.2rem, 4vw, 2.6rem); line-height: 1.2; }
    .two-col :is(p,li) { font-size: clamp(1rem, 2.5vw, 1.4rem); }
    @media (max-width: 900px) { .two-col { flex-direction: column; } }
    /* Vidéo responsive 16:9 */
    .video-container { position: relative; width: 100%; padding-bottom: 56.25%; height: 0; }
    .video-container iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: 0; }
  </style>
</head>
<body>
  <div class="reveal">
    <div class="slides">
      <!-- Charge le Markdown; utilisez --- pour séparer les slides, -- pour les sous-slides -->
      <section data-markdown="ConférenceIA.md"
               data-separator="^---$"
               data-separator-vertical="^--$"
               data-separator-notes="^Note:">
      </section>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/reveal.js@4/dist/reveal.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/reveal.js@4/plugin/markdown/markdown.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/reveal.js@4/plugin/highlight/highlight.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/reveal.js@4/plugin/notes/notes.js"></script>
  <script>
    Reveal.initialize({
      hash: true,
      slideNumber: true,
      center: false,
      plugins: [ RevealMarkdown, RevealHighlight, RevealNotes ],
    });

    // Transforme les slides marquées avec data-layout="text-image"
    function applyTextImageLayout() {
      const sections = document.querySelectorAll('section[data-layout="text-image"]');
      sections.forEach(sec => {
        if (sec.dataset.layoutApplied === '1') return;
        const imgSrc = sec.getAttribute('data-img');
        const alt = sec.getAttribute('data-alt') || '';
        const leftHTML = sec.innerHTML;

        const container = document.createElement('div');
        container.className = 'two-col';

        const left = document.createElement('div');
        left.className = 'col-left';
        left.innerHTML = leftHTML;

        const right = document.createElement('div');
        right.className = 'col-right';
        if (imgSrc) {
          const img = document.createElement('img');
          img.src = imgSrc;
          img.alt = alt;
          img.style.maxWidth = '100%';
          img.style.height = 'auto';
          right.appendChild(img);
        } else {
          const note = document.createElement('p');
          note.textContent = 'Ajoutez data-img="chemin/vers/image.png"';
          note.style.opacity = '0.7';
          right.appendChild(note);
        }

        container.appendChild(left);
        container.appendChild(right);
        sec.innerHTML = '';
        sec.appendChild(container);
        sec.dataset.layoutApplied = '1';
      });
    }

    Reveal.on('ready', applyTextImageLayout);
    // Applique aussi si du contenu dynamique est chargé ou si on change d'état
    Reveal.on('slidechanged', applyTextImageLayout);

    // Convertit une URL YouTube (youtu.be ou watch?v=) en URL d'embed
    function toYoutubeEmbed(url) {
      let embed = url;
      try {
        const u = new URL(url);
        // youtu.be/<id>
        if (u.hostname === 'youtu.be') {
          const id = u.pathname.replace('/', '');
          embed = `https://www.youtube.com/embed/${id}`;
        } else if (u.hostname.includes('youtube.com')) {
          // youtube.com/watch?v=<id>
          if (u.pathname === '/watch') {
            const id = u.searchParams.get('v');
            if (id) embed = `https://www.youtube.com/embed/${id}`;
          } else if (u.pathname.startsWith('/embed/')) {
            embed = url; // déjà embed
          }
        }
      } catch (e) { /* ignore, keep original */ }
      // Ajoute les paramètres d'autoplay et lecture inline (iOS) et mute pour compatibilité
      try {
        const eu = new URL(embed);
        eu.searchParams.set('autoplay', '1');
        eu.searchParams.set('mute', '1');
        eu.searchParams.set('playsinline', '1');
        return eu.toString();
      } catch (e) {
        return embed;
      }
    }

    // Mise en page texte à gauche / vidéo à droite
    function applyTextVideoLayout() {
      const sections = document.querySelectorAll('section[data-layout="text-video"]');
      sections.forEach(sec => {
        if (sec.dataset.layoutApplied === '1') return;
        const videoUrl = sec.getAttribute('data-video');
        const leftHTML = sec.innerHTML;

        const container = document.createElement('div');
        container.className = 'two-col';

        const left = document.createElement('div');
        left.className = 'col-left';
        left.innerHTML = leftHTML;

        const right = document.createElement('div');
        right.className = 'col-right';
        const wrapper = document.createElement('div');
        wrapper.className = 'video-container';
        const iframe = document.createElement('iframe');
        iframe.src = toYoutubeEmbed(videoUrl || '');
        iframe.allow = 'accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share';
        iframe.referrerPolicy = 'strict-origin-when-cross-origin';
        iframe.allowFullscreen = true;
        wrapper.appendChild(iframe);
        right.appendChild(wrapper);

        container.appendChild(left);
        container.appendChild(right);
        sec.innerHTML = '';
        sec.appendChild(container);
        sec.dataset.layoutApplied = '1';
      });
    }

    Reveal.on('ready', applyTextVideoLayout);
    Reveal.on('slidechanged', applyTextVideoLayout);
  </script>
</body>
</html>
