<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ConfÃ©rence IA â€” Slides</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/reveal.js@4/dist/reveal.css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/reveal.js@4/dist/theme/black.css" id="theme" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/reveal.js@4/plugin/math/math.css" />
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <button id="theme-toggle" title="Basculer dark/light mode" aria-label="Basculer le thÃ¨me">
    <span class="icon-sun">â˜€ï¸</span>
    <span class="icon-moon">ğŸŒ™</span>
  </button>
  <div class="reveal">
    <div class="slides">
      <!-- Charge le Markdown; utilisez --- pour sÃ©parer les slides, -- pour les sous-slides -->
      <section data-markdown="ConfÃ©renceIA.md"
               data-separator="^---$"
               data-separator-vertical="^--$"
               data-separator-notes="^Note:">
      </section>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/reveal.js@4/dist/reveal.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/reveal.js@4/plugin/markdown/markdown.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/reveal.js@4/plugin/highlight/highlight.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/reveal.js@4/plugin/notes/notes.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/reveal.js@4/plugin/math/math.js"></script>
  <script>
    Reveal.initialize({
      hash: true,
      slideNumber: true,
      center: false,
      width: '100%',
      height: '100%',
      margin: 0,
      minScale: 1,
      maxScale: 1,
      plugins: [ RevealMarkdown, RevealHighlight, RevealNotes, RevealMath.KaTeX ],
    });

    function attr(sec, name, defVal) {
      const v = sec.getAttribute(name);
      return (v === null || v === undefined || v === '') ? defVal : v;
    }

    // Convertit URL YouTube en embed
    function toYoutubeEmbed(url) {
      let embed = url;
      try {
        const u = new URL(url);
        if (u.hostname === 'youtu.be') {
          const id = u.pathname.replace('/', '');
          embed = `https://www.youtube.com/embed/${id}`;
        } else if (u.hostname.includes('youtube.com')) {
          if (u.pathname === '/watch') {
            const id = u.searchParams.get('v');
            if (id) embed = `https://www.youtube.com/embed/${id}`;
          } else if (u.pathname.startsWith('/embed/')) {
            embed = url;
          }
        }
      } catch (e) { }
      try {
        const eu = new URL(embed);
        eu.searchParams.set('autoplay', '1');
        eu.searchParams.set('mute', '1');
        eu.searchParams.set('playsinline', '1');
        return eu.toString();
      } catch (e) {
        return embed;
      }
    }

    // Layout deux colonnes avec texte dynamique
    function applyTwoColumnLayout() {
      const sections = document.querySelectorAll('section[data-layout="two-column"]');
      sections.forEach(sec => {
        if (sec.dataset.layoutApplied === '1') return;
        
        const imgSrc = attr(sec, 'data-img', '');
        const videoSrc = attr(sec, 'data-video', '');
        const alt = attr(sec, 'data-alt', 'Image');
        const side = attr(sec, 'data-side', 'right');
        
        // Extrait le titre
        const heading = sec.querySelector('h1, h2');
        let titleHTML = '';
        if (heading) {
          titleHTML = heading.outerHTML;
          heading.remove();
        }
        
        // RÃ©cupÃ¨re le contenu texte
        const textHTML = sec.innerHTML;
        
        // CrÃ©e la structure
        const container = document.createElement('div');
        container.className = 'slide-container';
        
        // Div titre
        if (titleHTML) {
          const titleDiv = document.createElement('div');
          titleDiv.className = 'slide-title';
          titleDiv.innerHTML = titleHTML;
          container.appendChild(titleDiv);
        }
        
        // Div colonnes
        const columnsDiv = document.createElement('div');
        columnsDiv.className = 'slide-columns';
        
        // Colonne texte
        const textDiv = document.createElement('div');
        textDiv.className = 'slide-text';
        const textContent = document.createElement('div');
        textContent.className = 'slide-text-content';
        textContent.innerHTML = textHTML;
        textDiv.appendChild(textContent);
        
        // Colonne mÃ©dia
        const mediaDiv = document.createElement('div');
        mediaDiv.className = 'slide-media';
        
        if (videoSrc) {
          const videoWrapper = document.createElement('div');
          videoWrapper.className = 'video-wrapper';
          const iframe = document.createElement('iframe');
          iframe.src = toYoutubeEmbed(videoSrc);
          iframe.allow = 'accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture';
          iframe.allowFullscreen = true;
          videoWrapper.appendChild(iframe);
          mediaDiv.appendChild(videoWrapper);
        } else if (imgSrc) {
          const img = document.createElement('img');
          img.src = imgSrc;
          img.alt = alt;
          mediaDiv.appendChild(img);
        }
        
        // Ordre des colonnes
        if (side === 'left') {
          columnsDiv.appendChild(mediaDiv);
          columnsDiv.appendChild(textDiv);
        } else {
          columnsDiv.appendChild(textDiv);
          columnsDiv.appendChild(mediaDiv);
        }
        
        container.appendChild(columnsDiv);
        
        // Remplace le contenu de la section
        sec.innerHTML = '';
        sec.appendChild(container);
        sec.dataset.layoutApplied = '1';
        
        // Applique le scaling du texte
        scaleText(textContent, textDiv);
      });
    }

    // Ajuste la taille du texte pour remplir la hauteur
    function scaleText(textContent, textContainer) {
      requestAnimationFrame(() => {
        setTimeout(() => {
          // Reset complÃ¨tement le transform
          textContent.style.transform = '';
          
          // Force plusieurs reflows
          void textContent.offsetHeight;
          void textContainer.offsetHeight;
          
          // Attendre un peu plus pour que le DOM se stabilise
          setTimeout(() => {
            // Mesure la hauteur et largeur du conteneur disponible
            const containerHeight = textContainer.clientHeight;
            const containerWidth = textContainer.clientWidth;
            
            // Mesure la hauteur et largeur naturelle du contenu
            const contentHeight = textContent.scrollHeight;
            const contentWidth = textContent.scrollWidth;
            
            if (containerHeight > 10 && contentHeight > 10 && containerWidth > 10 && contentWidth > 10) {
              // Calcule le scale pour hauteur et largeur
              const scaleHeight = containerHeight / contentHeight;
              const scaleWidth = containerWidth / contentWidth;
              
              // Prend le minimum des deux pour Ã©viter tout dÃ©bordement
              let scale = Math.min(scaleHeight, scaleWidth) * 0.92;
              
              // Applique le scale
              textContent.style.transform = `scale(${scale})`;
              textContent.style.transformOrigin = 'top left';
              
              // VÃ©rifie si Ã§a dÃ©borde et rÃ©ajuste si nÃ©cessaire
              setTimeout(() => {
                const newRect = textContent.getBoundingClientRect();
                const containerRect = textContainer.getBoundingClientRect();
                
                // VÃ©rifie dÃ©bordement en hauteur
                if (newRect.height > containerRect.height) {
                  scale = scale * (containerRect.height / newRect.height) * 0.95;
                  textContent.style.transform = `scale(${scale})`;
                }
                
                // VÃ©rifie dÃ©bordement en largeur
                if (newRect.width > containerRect.width) {
                  scale = scale * (containerRect.width / newRect.width) * 0.95;
                  textContent.style.transform = `scale(${scale})`;
                }
              }, 50);
            }
          }, 50);
        }, 200);
      });
    }

    Reveal.on('ready', applyTwoColumnLayout);
    Reveal.on('slidechanged', () => {
      applyTwoColumnLayout();
      // Re-scale le texte aprÃ¨s changement de slide
      setTimeout(() => {
        document.querySelectorAll('.slide-text-content').forEach(content => {
          const container = content.closest('.slide-text');
          if (container) {
            scaleText(content, container);
          }
        });
      }, 200);
    });
    window.addEventListener('resize', () => {
      document.querySelectorAll('.slide-text-content').forEach(content => {
        const container = content.closest('.slide-text');
        if (container) {
          scaleText(content, container);
        }
      });
    });

    // Gestion du toggle dark/light mode
    const themeToggle = document.getElementById('theme-toggle');
    const themeLink = document.getElementById('theme');
    const savedTheme = localStorage.getItem('reveal-theme') || 'dark';
    
    function setTheme(mode) {
      const themePath = mode === 'light' 
        ? 'https://cdn.jsdelivr.net/npm/reveal.js@4/dist/theme/white.css'
        : 'https://cdn.jsdelivr.net/npm/reveal.js@4/dist/theme/black.css';
      
      themeLink.href = themePath;
      document.body.setAttribute('data-theme', mode);
      localStorage.setItem('reveal-theme', mode);
    }
    
    // Applique le thÃ¨me sauvegardÃ©
    setTheme(savedTheme);
    
    // Toggle au clic
    themeToggle.addEventListener('click', () => {
      const currentTheme = document.body.getAttribute('data-theme') || 'dark';
      const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
      setTheme(newTheme);
    });
  </script>
</body>
</html>
